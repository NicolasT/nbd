<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Network.NBD.Server.Simple</title><link href="ocean.css" rel="stylesheet" type="text/css" title="Ocean" /><script src="haddock-util.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
window.onload = function () {pageLoad();setSynopsis("mini_Network-NBD-Server-Simple.html");};
//]]>
</script></head><body><div id="package-header"><ul class="links" id="page-menu"><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul><p class="caption">nbd-0.1.0.0: A Haskell library to implement NBD (Network Block Device) servers</p></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>None</td></tr></table><p class="caption">Network.NBD.Server.Simple</p></div><div id="table-of-contents"><p class="caption">Contents</p><ul><li><a href="#g:1">Action result representations
</a></li><li><a href="#g:2">Action handlers
</a></li><li><a href="#g:3">Server execution
</a></li><li><a href="#g:4">Utilities
</a></li></ul></div><div id="synopsis"><p id="control.syn" class="caption expander" onclick="toggleSection('syn')">Synopsis</p><ul id="section.syn" class="hide" onclick="toggleSection('syn')"><li class="src short"><span class="keyword">data</span>  <a href="#t:Response">Response</a> a<ul class="subs"><li>= <a href="#v:OK">OK</a> a  </li><li>| <a href="#v:Error">Error</a> <a href="/home/nicolas/Projects/ghc/share/doc/ghc/html/libraries/base-4.6.0.0/Foreign-C-Error.html#t:Errno">Errno</a>  </li></ul></li><li class="src short"><span class="keyword">data</span>  <a href="#t:ReadResponse">ReadResponse</a> <ul class="subs"><li>= <a href="#v:Data">Data</a> <a href="/home/nicolas/Projects/ghc/share/doc/ghc/html/libraries/bytestring-0.10.0.0/Data-ByteString-Lazy.html#t:ByteString">ByteString</a>  </li><li>| <a href="#v:Sendfile">Sendfile</a> <a href="/home/nicolas/Projects/ghc/share/doc/ghc/html/libraries/base-4.6.0.0/System-Posix-Types.html#t:Fd">Fd</a> <a href="Network-NBD-Server-Simple.html#t:FileRange">FileRange</a>  </li></ul></li><li class="src short"><span class="keyword">data</span>  <a href="#t:FileRange">FileRange</a> <ul class="subs"><li>= <a href="#v:EntireFile">EntireFile</a>  </li><li>| <a href="#v:PartOfFile">PartOfFile</a> { <ul class="subs"><li><a href="#v:rangeOffset">rangeOffset</a> :: <a href="/home/nicolas/Projects/ghc/share/doc/ghc/html/libraries/base-4.6.0.0/Prelude.html#t:Integer">Integer</a></li><li><a href="#v:rangeLength">rangeLength</a> :: <a href="/home/nicolas/Projects/ghc/share/doc/ghc/html/libraries/base-4.6.0.0/Prelude.html#t:Integer">Integer</a></li></ul> }</li></ul></li><li class="src short"><span class="keyword">data</span>  <a href="#t:ExportHandler">ExportHandler</a>  = <a href="#v:ExportHandler">ExportHandler</a> {<ul class="subs"><li><a href="#v:handleRead">handleRead</a> :: <a href="Network-NBD-Server-Simple.html#t:ReadHandler">ReadHandler</a></li><li><a href="#v:handleWrite">handleWrite</a> :: <a href="/home/nicolas/Projects/ghc/share/doc/ghc/html/libraries/base-4.6.0.0/Data-Maybe.html#t:Maybe">Maybe</a> <a href="Network-NBD-Server-Simple.html#t:WriteHandler">WriteHandler</a></li><li><a href="#v:handleFlush">handleFlush</a> :: <a href="/home/nicolas/Projects/ghc/share/doc/ghc/html/libraries/base-4.6.0.0/Data-Maybe.html#t:Maybe">Maybe</a> <a href="Network-NBD-Server-Simple.html#t:FlushHandler">FlushHandler</a></li><li><a href="#v:handleTrim">handleTrim</a> :: <a href="/home/nicolas/Projects/ghc/share/doc/ghc/html/libraries/base-4.6.0.0/Data-Maybe.html#t:Maybe">Maybe</a> <a href="Network-NBD-Server-Simple.html#t:TrimHandler">TrimHandler</a></li><li><a href="#v:handleDisconnect">handleDisconnect</a> :: <a href="/home/nicolas/Projects/ghc/share/doc/ghc/html/libraries/base-4.6.0.0/Data-Maybe.html#t:Maybe">Maybe</a> <a href="Network-NBD-Server-Simple.html#t:DisconnectHandler">DisconnectHandler</a></li><li><a href="#v:handleUnknownCommand">handleUnknownCommand</a> :: <a href="/home/nicolas/Projects/ghc/share/doc/ghc/html/libraries/base-4.6.0.0/Data-Maybe.html#t:Maybe">Maybe</a> <a href="Network-NBD-Server-Simple.html#t:UnknownCommandHandler">UnknownCommandHandler</a></li><li><a href="#v:handleSize">handleSize</a> :: <a href="Network-NBD-Server-Simple.html#t:ByteCount">ByteCount</a></li><li><a href="#v:handleHasFUA">handleHasFUA</a> :: <a href="/home/nicolas/Projects/ghc/share/doc/ghc/html/libraries/base-4.6.0.0/Data-Bool.html#t:Bool">Bool</a></li><li><a href="#v:handleIsRotational">handleIsRotational</a> :: <a href="/home/nicolas/Projects/ghc/share/doc/ghc/html/libraries/base-4.6.0.0/Data-Bool.html#t:Bool">Bool</a></li></ul>}</li><li class="src short"><span class="keyword">type</span> <a href="#t:FileOffset">FileOffset</a> = <a href="/home/nicolas/Projects/ghc/share/doc/ghc/html/libraries/base-4.6.0.0/System-Posix-Types.html#t:COff">COff</a></li><li class="src short"><span class="keyword">type</span> <a href="#t:ByteCount">ByteCount</a> = <a href="/home/nicolas/Projects/ghc/share/doc/ghc/html/libraries/base-4.6.0.0/Foreign-C-Types.html#t:CSize">CSize</a></li><li class="src short"><span class="keyword">data</span>  <a href="#t:NbdCommandFlag">NbdCommandFlag</a>  = <a href="#v:ForceUnitAccess">ForceUnitAccess</a></li><li class="src short"><span class="keyword">type</span> <a href="#t:Flags">Flags</a> = [<a href="Network-NBD-Server-Simple.html#t:NbdCommandFlag">NbdCommandFlag</a>]</li><li class="src short"><span class="keyword">type</span> <a href="#t:ReadHandler">ReadHandler</a> = <a href="Network-NBD-Server-Simple.html#t:FileOffset">FileOffset</a> -&gt; <a href="Network-NBD-Server-Simple.html#t:ByteCount">ByteCount</a> -&gt; <a href="Network-NBD-Server-Simple.html#t:Flags">Flags</a> -&gt; <a href="/home/nicolas/Projects/ghc/share/doc/ghc/html/libraries/base-4.6.0.0/System-IO.html#t:IO">IO</a> (<a href="Network-NBD-Server-Simple.html#t:Response">Response</a> <a href="Network-NBD-Server-Simple.html#t:ReadResponse">ReadResponse</a>)</li><li class="src short"><span class="keyword">type</span> <a href="#t:WriteHandler">WriteHandler</a> = <a href="Network-NBD-Server-Simple.html#t:FileOffset">FileOffset</a> -&gt; <a href="/home/nicolas/Projects/ghc/share/doc/ghc/html/libraries/bytestring-0.10.0.0/Data-ByteString-Lazy.html#t:ByteString">ByteString</a> -&gt; <a href="Network-NBD-Server-Simple.html#t:Flags">Flags</a> -&gt; <a href="/home/nicolas/Projects/ghc/share/doc/ghc/html/libraries/base-4.6.0.0/System-IO.html#t:IO">IO</a> (<a href="Network-NBD-Server-Simple.html#t:Response">Response</a> ())</li><li class="src short"><span class="keyword">type</span> <a href="#t:FlushHandler">FlushHandler</a> = <a href="Network-NBD-Server-Simple.html#t:Flags">Flags</a> -&gt; <a href="/home/nicolas/Projects/ghc/share/doc/ghc/html/libraries/base-4.6.0.0/System-IO.html#t:IO">IO</a> (<a href="Network-NBD-Server-Simple.html#t:Response">Response</a> ())</li><li class="src short"><span class="keyword">type</span> <a href="#t:TrimHandler">TrimHandler</a> = <a href="Network-NBD-Server-Simple.html#t:FileOffset">FileOffset</a> -&gt; <a href="Network-NBD-Server-Simple.html#t:ByteCount">ByteCount</a> -&gt; <a href="Network-NBD-Server-Simple.html#t:Flags">Flags</a> -&gt; <a href="/home/nicolas/Projects/ghc/share/doc/ghc/html/libraries/base-4.6.0.0/System-IO.html#t:IO">IO</a> (<a href="Network-NBD-Server-Simple.html#t:Response">Response</a> ())</li><li class="src short"><span class="keyword">type</span> <a href="#t:DisconnectHandler">DisconnectHandler</a> = <a href="Network-NBD-Server-Simple.html#t:Flags">Flags</a> -&gt; <a href="/home/nicolas/Projects/ghc/share/doc/ghc/html/libraries/base-4.6.0.0/System-IO.html#t:IO">IO</a> ()</li><li class="src short"><span class="keyword">type</span> <a href="#t:CommandId">CommandId</a> = <a href="/home/nicolas/Projects/ghc/share/doc/ghc/html/libraries/base-4.6.0.0/Data-Word.html#t:Word32">Word32</a></li><li class="src short"><span class="keyword">type</span> <a href="#t:UnknownCommandHandler">UnknownCommandHandler</a> = <a href="Network-NBD-Server-Simple.html#t:CommandId">CommandId</a> -&gt; <a href="Network-NBD-Server-Simple.html#t:FileOffset">FileOffset</a> -&gt; <a href="Network-NBD-Server-Simple.html#t:ByteCount">ByteCount</a> -&gt; <a href="Network-NBD-Server-Simple.html#t:Flags">Flags</a> -&gt; <a href="/home/nicolas/Projects/ghc/share/doc/ghc/html/libraries/base-4.6.0.0/System-IO.html#t:IO">IO</a> (<a href="Network-NBD-Server-Simple.html#t:Response">Response</a> ())</li><li class="src short"><span class="keyword">type</span> <a href="#t:ExportMaker">ExportMaker</a> = <a href="/home/nicolas/Projects/nbd/hs/cabal-dev//share/doc/network-2.4.0.1/html/Network-Socket-Internal.html#t:SockAddr">SockAddr</a> -&gt; <a href="Network-NBD.html#t:ExportName">ExportName</a> -&gt; <a href="/home/nicolas/Projects/ghc/share/doc/ghc/html/libraries/base-4.6.0.0/System-IO.html#t:IO">IO</a> (<a href="/home/nicolas/Projects/ghc/share/doc/ghc/html/libraries/base-4.6.0.0/Data-Maybe.html#t:Maybe">Maybe</a> <a href="Network-NBD-Server-Simple.html#t:ExportHandler">ExportHandler</a>)</li><li class="src short"><span class="keyword">data</span>  <a href="#t:ServerSettings">ServerSettings</a> <ul class="subs"><li>= <a href="#v:TCPServerSettings">TCPServerSettings</a> <a href="/home/nicolas/Projects/ghc/share/doc/ghc/html/libraries/base-4.6.0.0/Data-Int.html#t:Int">Int</a> <a href="Network-NBD-Server-Simple.html#t:HostPreference">HostPreference</a>  </li><li>| <a href="#v:UNIXServerSettings">UNIXServerSettings</a> <a href="/home/nicolas/Projects/ghc/share/doc/ghc/html/libraries/base-4.6.0.0/System-IO.html#t:FilePath">FilePath</a>  </li></ul></li><li class="src short"><span class="keyword">data</span>  <a href="#t:HostPreference">HostPreference</a> <ul class="subs"><li>= <a href="#v:HostAny">HostAny</a>  </li><li>| <a href="#v:HostIPv4">HostIPv4</a>  </li><li>| <a href="#v:HostIPv6">HostIPv6</a>  </li><li>| <a href="#v:Host">Host</a> <a href="/home/nicolas/Projects/ghc/share/doc/ghc/html/libraries/base-4.6.0.0/Data-String.html#t:String">String</a>  </li></ul></li><li class="src short"><a href="#v:nBD_DEFAULT_PORT">nBD_DEFAULT_PORT</a> :: <a href="/home/nicolas/Projects/ghc/share/doc/ghc/html/libraries/base-4.6.0.0/Data-Int.html#t:Int">Int</a></li><li class="src short"><a href="#v:runServer">runServer</a> :: <a href="Network-NBD-Server-Simple.html#t:ServerSettings">ServerSettings</a> -&gt; <a href="/home/nicolas/Projects/ghc/share/doc/ghc/html/libraries/base-4.6.0.0/Data-Maybe.html#t:Maybe">Maybe</a> [<a href="Network-NBD.html#t:ExportName">ExportName</a>] -&gt; <a href="Network-NBD-Server-Simple.html#t:ExportMaker">ExportMaker</a> -&gt; <a href="/home/nicolas/Projects/ghc/share/doc/ghc/html/libraries/base-4.6.0.0/System-IO.html#t:IO">IO</a> ()</li><li class="src short"><a href="#v:withBoundsCheck">withBoundsCheck</a> :: <a href="/home/nicolas/Projects/ghc/share/doc/ghc/html/libraries/base-4.6.0.0/Control-Monad.html#t:Monad">Monad</a> m =&gt; <a href="Network-NBD-Server-Simple.html#t:ByteCount">ByteCount</a> -&gt; <a href="Network-NBD-Server-Simple.html#t:FileOffset">FileOffset</a> -&gt; <a href="Network-NBD-Server-Simple.html#t:ByteCount">ByteCount</a> -&gt; m (<a href="Network-NBD-Server-Simple.html#t:Response">Response</a> a) -&gt; m (<a href="Network-NBD-Server-Simple.html#t:Response">Response</a> a)</li></ul></div><div id="interface"><h1 id="g:1">Action result representations
</h1><div class="top"><p class="src"><span class="keyword">data</span>  <a name="t:Response" class="def">Response</a> a </p><div class="doc"><p>Success indicator returned by action handlers
</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a name="v:OK" class="def">OK</a> a</td><td class="doc"><p>Success
</p></td></tr><tr><td class="src"><a name="v:Error" class="def">Error</a> <a href="/home/nicolas/Projects/ghc/share/doc/ghc/html/libraries/base-4.6.0.0/Foreign-C-Error.html#t:Errno">Errno</a></td><td class="doc"><p>Failure. The given <code><a href="/home/nicolas/Projects/ghc/share/doc/ghc/html/libraries/base-4.6.0.0/Foreign-C-Error.html#t:Errno">Errno</a></code> will be returned to the client
</p></td></tr></table></div></div><div class="top"><p class="src"><span class="keyword">data</span>  <a name="t:ReadResponse" class="def">ReadResponse</a>  </p><div class="doc"><p>Response data returned by a <code><a href="Network-NBD-Server-Simple.html#t:ReadHandler">ReadHandler</a></code>
</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a name="v:Data" class="def">Data</a> <a href="/home/nicolas/Projects/ghc/share/doc/ghc/html/libraries/bytestring-0.10.0.0/Data-ByteString-Lazy.html#t:ByteString">ByteString</a></td><td class="doc"><p>Return given data as request reply
</p></td></tr><tr><td class="src"><a name="v:Sendfile" class="def">Sendfile</a> <a href="/home/nicolas/Projects/ghc/share/doc/ghc/html/libraries/base-4.6.0.0/System-Posix-Types.html#t:Fd">Fd</a> <a href="Network-NBD-Server-Simple.html#t:FileRange">FileRange</a></td><td class="doc"><p>Use sendfile to return some data
</p></td></tr></table></div></div><div class="top"><p class="src"><span class="keyword">data</span>  <a name="t:FileRange" class="def">FileRange</a>  </p><div class="doc"><p>File range for <code>sendfile</code>.
</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a name="v:EntireFile" class="def">EntireFile</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a name="v:PartOfFile" class="def">PartOfFile</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><dl><dt class="src"><a name="v:rangeOffset" class="def">rangeOffset</a> :: <a href="/home/nicolas/Projects/ghc/share/doc/ghc/html/libraries/base-4.6.0.0/Prelude.html#t:Integer">Integer</a></dt><dd class="doc empty">&nbsp;</dd><dt class="src"><a name="v:rangeLength" class="def">rangeLength</a> :: <a href="/home/nicolas/Projects/ghc/share/doc/ghc/html/libraries/base-4.6.0.0/Prelude.html#t:Integer">Integer</a></dt><dd class="doc empty">&nbsp;</dd></dl><div class="clear"></div></div></td></tr></table></div></div><h1 id="g:2">Action handlers
</h1><div class="top"><p class="src"><span class="keyword">data</span>  <a name="t:ExportHandler" class="def">ExportHandler</a>  </p><div class="doc"><p>Action vtable to handle client requests. Any <code><a href="/home/nicolas/Projects/ghc/share/doc/ghc/html/libraries/base-4.6.0.0/Data-Maybe.html#t:Maybe">Maybe</a></code> field can be set
 to <code><a href="/home/nicolas/Projects/ghc/share/doc/ghc/html/libraries/base-4.6.0.0/Data-Maybe.html#v:Nothing">Nothing</a></code>, which implies the given feature is not available on the
 server. The feature flags sent to a client during protocol negotiation
 will be based on this.
</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a name="v:ExportHandler" class="def">ExportHandler</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><dl><dt class="src"><a name="v:handleRead" class="def">handleRead</a> :: <a href="Network-NBD-Server-Simple.html#t:ReadHandler">ReadHandler</a></dt><dd class="doc"><p>Handle a <code><a href="/home/nicolas/Projects/ghc/share/doc/ghc/html/libraries/base-4.6.0.0/Text-Read.html#t:Read">Read</a></code> request
</p></dd><dt class="src"><a name="v:handleWrite" class="def">handleWrite</a> :: <a href="/home/nicolas/Projects/ghc/share/doc/ghc/html/libraries/base-4.6.0.0/Data-Maybe.html#t:Maybe">Maybe</a> <a href="Network-NBD-Server-Simple.html#t:WriteHandler">WriteHandler</a></dt><dd class="doc"><p>Handle a <code><a href="Network-NBD-Server.html#v:Write">Write</a></code> request
</p></dd><dt class="src"><a name="v:handleFlush" class="def">handleFlush</a> :: <a href="/home/nicolas/Projects/ghc/share/doc/ghc/html/libraries/base-4.6.0.0/Data-Maybe.html#t:Maybe">Maybe</a> <a href="Network-NBD-Server-Simple.html#t:FlushHandler">FlushHandler</a></dt><dd class="doc"><p>Handle a <code><a href="Network-NBD-Server.html#v:Flush">Flush</a></code> request
</p></dd><dt class="src"><a name="v:handleTrim" class="def">handleTrim</a> :: <a href="/home/nicolas/Projects/ghc/share/doc/ghc/html/libraries/base-4.6.0.0/Data-Maybe.html#t:Maybe">Maybe</a> <a href="Network-NBD-Server-Simple.html#t:TrimHandler">TrimHandler</a></dt><dd class="doc"><p>Handle a <code><a href="Network-NBD-Server.html#v:Trim">Trim</a></code> request
</p></dd><dt class="src"><a name="v:handleDisconnect" class="def">handleDisconnect</a> :: <a href="/home/nicolas/Projects/ghc/share/doc/ghc/html/libraries/base-4.6.0.0/Data-Maybe.html#t:Maybe">Maybe</a> <a href="Network-NBD-Server-Simple.html#t:DisconnectHandler">DisconnectHandler</a></dt><dd class="doc"><p>Action to run prior to disconnecting a client due to a <code><a href="Network-NBD-Server.html#v:Disconnect">Disconnect</a></code> request
</p></dd><dt class="src"><a name="v:handleUnknownCommand" class="def">handleUnknownCommand</a> :: <a href="/home/nicolas/Projects/ghc/share/doc/ghc/html/libraries/base-4.6.0.0/Data-Maybe.html#t:Maybe">Maybe</a> <a href="Network-NBD-Server-Simple.html#t:UnknownCommandHandler">UnknownCommandHandler</a></dt><dd class="doc"><p>Handle an unknown request
</p></dd><dt class="src"><a name="v:handleSize" class="def">handleSize</a> :: <a href="Network-NBD-Server-Simple.html#t:ByteCount">ByteCount</a></dt><dd class="doc"><p>Size of the export
</p></dd><dt class="src"><a name="v:handleHasFUA" class="def">handleHasFUA</a> :: <a href="/home/nicolas/Projects/ghc/share/doc/ghc/html/libraries/base-4.6.0.0/Data-Bool.html#t:Bool">Bool</a></dt><dd class="doc"><p>Server supports the <code><a href="Network-NBD-Server-Simple.html#v:ForceUnitAccess">ForceUnitAccess</a></code> request flag
</p></dd><dt class="src"><a name="v:handleIsRotational" class="def">handleIsRotational</a> :: <a href="/home/nicolas/Projects/ghc/share/doc/ghc/html/libraries/base-4.6.0.0/Data-Bool.html#t:Bool">Bool</a></dt><dd class="doc"><p>Server exposes a rotational device (which might impact the client IO scheduler)
</p></dd></dl><div class="clear"></div></div></td></tr></table></div></div><div class="top"><p class="src"><span class="keyword">type</span> <a name="t:FileOffset" class="def">FileOffset</a> = <a href="/home/nicolas/Projects/ghc/share/doc/ghc/html/libraries/base-4.6.0.0/System-Posix-Types.html#t:COff">COff</a></p></div><div class="top"><p class="src"><span class="keyword">type</span> <a name="t:ByteCount" class="def">ByteCount</a> = <a href="/home/nicolas/Projects/ghc/share/doc/ghc/html/libraries/base-4.6.0.0/Foreign-C-Types.html#t:CSize">CSize</a></p></div><div class="top"><p class="src"><span class="keyword">data</span>  <a name="t:NbdCommandFlag" class="def">NbdCommandFlag</a>  </p><div class="doc"><p>Flags set on NBD commands
</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a name="v:ForceUnitAccess" class="def">ForceUnitAccess</a></td><td class="doc"><p>Force Unit Access on NBD_CMD_WRITE
</p></td></tr></table></div><div class="subs instances"><p id="control.i:NbdCommandFlag" class="caption collapser" onclick="toggleSection('i:NbdCommandFlag')">Instances</p><div id="section.i:NbdCommandFlag" class="show"><table><tr><td class="src"><a href="/home/nicolas/Projects/ghc/share/doc/ghc/html/libraries/base-4.6.0.0/Prelude.html#t:Enum">Enum</a> <a href="Network-NBD-Server-Simple.html#t:NbdCommandFlag">NbdCommandFlag</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a href="/home/nicolas/Projects/ghc/share/doc/ghc/html/libraries/base-4.6.0.0/Data-Eq.html#t:Eq">Eq</a> <a href="Network-NBD-Server-Simple.html#t:NbdCommandFlag">NbdCommandFlag</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a href="/home/nicolas/Projects/ghc/share/doc/ghc/html/libraries/base-4.6.0.0/Text-Show.html#t:Show">Show</a> <a href="Network-NBD-Server-Simple.html#t:NbdCommandFlag">NbdCommandFlag</a></td><td class="doc empty">&nbsp;</td></tr></table></div></div></div><div class="top"><p class="src"><span class="keyword">type</span> <a name="t:Flags" class="def">Flags</a> = [<a href="Network-NBD-Server-Simple.html#t:NbdCommandFlag">NbdCommandFlag</a>]</p><div class="doc"><p>Type synonym for a list of <code><a href="Network-NBD-Server-Simple.html#t:NbdCommandFlag">NbdCommandFlag</a></code>s
</p></div></div><div class="top"><p class="src"><span class="keyword">type</span> <a name="t:ReadHandler" class="def">ReadHandler</a> = <a href="Network-NBD-Server-Simple.html#t:FileOffset">FileOffset</a> -&gt; <a href="Network-NBD-Server-Simple.html#t:ByteCount">ByteCount</a> -&gt; <a href="Network-NBD-Server-Simple.html#t:Flags">Flags</a> -&gt; <a href="/home/nicolas/Projects/ghc/share/doc/ghc/html/libraries/base-4.6.0.0/System-IO.html#t:IO">IO</a> (<a href="Network-NBD-Server-Simple.html#t:Response">Response</a> <a href="Network-NBD-Server-Simple.html#t:ReadResponse">ReadResponse</a>)</p><div class="doc"><p><code><a href="/home/nicolas/Projects/ghc/share/doc/ghc/html/libraries/base-4.6.0.0/Text-Read.html#t:Read">Read</a></code> request handler prototype
</p></div></div><div class="top"><p class="src"><span class="keyword">type</span> <a name="t:WriteHandler" class="def">WriteHandler</a> = <a href="Network-NBD-Server-Simple.html#t:FileOffset">FileOffset</a> -&gt; <a href="/home/nicolas/Projects/ghc/share/doc/ghc/html/libraries/bytestring-0.10.0.0/Data-ByteString-Lazy.html#t:ByteString">ByteString</a> -&gt; <a href="Network-NBD-Server-Simple.html#t:Flags">Flags</a> -&gt; <a href="/home/nicolas/Projects/ghc/share/doc/ghc/html/libraries/base-4.6.0.0/System-IO.html#t:IO">IO</a> (<a href="Network-NBD-Server-Simple.html#t:Response">Response</a> ())</p><div class="doc"><p><code><a href="Network-NBD-Server.html#v:Write">Write</a></code> request handler prototype
</p></div></div><div class="top"><p class="src"><span class="keyword">type</span> <a name="t:FlushHandler" class="def">FlushHandler</a> = <a href="Network-NBD-Server-Simple.html#t:Flags">Flags</a> -&gt; <a href="/home/nicolas/Projects/ghc/share/doc/ghc/html/libraries/base-4.6.0.0/System-IO.html#t:IO">IO</a> (<a href="Network-NBD-Server-Simple.html#t:Response">Response</a> ())</p><div class="doc"><p><code><a href="Network-NBD-Server.html#v:Flush">Flush</a></code> request handler prototype
</p></div></div><div class="top"><p class="src"><span class="keyword">type</span> <a name="t:TrimHandler" class="def">TrimHandler</a> = <a href="Network-NBD-Server-Simple.html#t:FileOffset">FileOffset</a> -&gt; <a href="Network-NBD-Server-Simple.html#t:ByteCount">ByteCount</a> -&gt; <a href="Network-NBD-Server-Simple.html#t:Flags">Flags</a> -&gt; <a href="/home/nicolas/Projects/ghc/share/doc/ghc/html/libraries/base-4.6.0.0/System-IO.html#t:IO">IO</a> (<a href="Network-NBD-Server-Simple.html#t:Response">Response</a> ())</p><div class="doc"><p><code><a href="Network-NBD-Server.html#v:Trim">Trim</a></code> request handler prototype
</p></div></div><div class="top"><p class="src"><span class="keyword">type</span> <a name="t:DisconnectHandler" class="def">DisconnectHandler</a> = <a href="Network-NBD-Server-Simple.html#t:Flags">Flags</a> -&gt; <a href="/home/nicolas/Projects/ghc/share/doc/ghc/html/libraries/base-4.6.0.0/System-IO.html#t:IO">IO</a> ()</p><div class="doc"><p>Disconnect request handler prototype. Note the connection will be
 closed by the server when receiving a <code><a href="Network-NBD-Server.html#v:Disconnect">Disconnect</a></code> request, after
 executing any given handler, even if the handler throws an <code><a href="/home/nicolas/Projects/ghc/share/doc/ghc/html/libraries/base-4.6.0.0/Control-Exception-Base.html#t:Exception">Exception</a></code>.
</p></div></div><div class="top"><p class="src"><span class="keyword">type</span> <a name="t:CommandId" class="def">CommandId</a> = <a href="/home/nicolas/Projects/ghc/share/doc/ghc/html/libraries/base-4.6.0.0/Data-Word.html#t:Word32">Word32</a></p><div class="doc"><p>Command identifier for requests received from a client
</p></div></div><div class="top"><p class="src"><span class="keyword">type</span> <a name="t:UnknownCommandHandler" class="def">UnknownCommandHandler</a> = <a href="Network-NBD-Server-Simple.html#t:CommandId">CommandId</a> -&gt; <a href="Network-NBD-Server-Simple.html#t:FileOffset">FileOffset</a> -&gt; <a href="Network-NBD-Server-Simple.html#t:ByteCount">ByteCount</a> -&gt; <a href="Network-NBD-Server-Simple.html#t:Flags">Flags</a> -&gt; <a href="/home/nicolas/Projects/ghc/share/doc/ghc/html/libraries/base-4.6.0.0/System-IO.html#t:IO">IO</a> (<a href="Network-NBD-Server-Simple.html#t:Response">Response</a> ())</p><div class="doc"><p>Unknown request handler prototype
</p></div></div><h1 id="g:3">Server execution
</h1><div class="top"><p class="src"><span class="keyword">type</span> <a name="t:ExportMaker" class="def">ExportMaker</a> = <a href="/home/nicolas/Projects/nbd/hs/cabal-dev//share/doc/network-2.4.0.1/html/Network-Socket-Internal.html#t:SockAddr">SockAddr</a> -&gt; <a href="Network-NBD.html#t:ExportName">ExportName</a> -&gt; <a href="/home/nicolas/Projects/ghc/share/doc/ghc/html/libraries/base-4.6.0.0/System-IO.html#t:IO">IO</a> (<a href="/home/nicolas/Projects/ghc/share/doc/ghc/html/libraries/base-4.6.0.0/Data-Maybe.html#t:Maybe">Maybe</a> <a href="Network-NBD-Server-Simple.html#t:ExportHandler">ExportHandler</a>)</p><div class="doc"><p>Prototype of an action turning a <code>SockAddr</code> and <code><a href="Network-NBD.html#t:ExportName">ExportName</a></code> into an
 export, or rather its <code><a href="Network-NBD-Server-Simple.html#t:ExportHandler">ExportHandler</a></code> vtable. If <code><a href="/home/nicolas/Projects/ghc/share/doc/ghc/html/libraries/base-4.6.0.0/Data-Maybe.html#v:Nothing">Nothing</a></code> is returned,
 this implies the given <code><a href="Network-NBD.html#t:ExportName">ExportName</a></code> was invalid, and the server should
 act accordingly.
</p></div></div><div class="top"><p class="src"><span class="keyword">data</span>  <a name="t:ServerSettings" class="def">ServerSettings</a>  </p><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a name="v:TCPServerSettings" class="def">TCPServerSettings</a> <a href="/home/nicolas/Projects/ghc/share/doc/ghc/html/libraries/base-4.6.0.0/Data-Int.html#t:Int">Int</a> <a href="Network-NBD-Server-Simple.html#t:HostPreference">HostPreference</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a name="v:UNIXServerSettings" class="def">UNIXServerSettings</a> <a href="/home/nicolas/Projects/ghc/share/doc/ghc/html/libraries/base-4.6.0.0/System-IO.html#t:FilePath">FilePath</a></td><td class="doc empty">&nbsp;</td></tr></table></div><div class="subs instances"><p id="control.i:ServerSettings" class="caption collapser" onclick="toggleSection('i:ServerSettings')">Instances</p><div id="section.i:ServerSettings" class="show"><table><tr><td class="src"><a href="/home/nicolas/Projects/ghc/share/doc/ghc/html/libraries/base-4.6.0.0/Data-Eq.html#t:Eq">Eq</a> <a href="Network-NBD-Server-Simple.html#t:ServerSettings">ServerSettings</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a href="/home/nicolas/Projects/ghc/share/doc/ghc/html/libraries/base-4.6.0.0/Text-Show.html#t:Show">Show</a> <a href="Network-NBD-Server-Simple.html#t:ServerSettings">ServerSettings</a></td><td class="doc empty">&nbsp;</td></tr></table></div></div></div><div class="top"><p class="src"><span class="keyword">data</span>  <a name="t:HostPreference" class="def">HostPreference</a>  </p><div class="doc"><p>Which host to bind.
</p><p>Note: The <code>IsString</code> instance recognizes the following special values:
</p><ul><li> <code>*</code> means <code>HostAny</code>
</li><li> <code>*4</code> means <code>HostIPv4</code>
</li><li> <code>*6</code> means <code>HostIPv6</code>
</li></ul></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a name="v:HostAny" class="def">HostAny</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a name="v:HostIPv4" class="def">HostIPv4</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a name="v:HostIPv6" class="def">HostIPv6</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a name="v:Host" class="def">Host</a> <a href="/home/nicolas/Projects/ghc/share/doc/ghc/html/libraries/base-4.6.0.0/Data-String.html#t:String">String</a></td><td class="doc empty">&nbsp;</td></tr></table></div><div class="subs instances"><p id="control.i:HostPreference" class="caption collapser" onclick="toggleSection('i:HostPreference')">Instances</p><div id="section.i:HostPreference" class="show"><table><tr><td class="src"><a href="/home/nicolas/Projects/ghc/share/doc/ghc/html/libraries/base-4.6.0.0/Data-Eq.html#t:Eq">Eq</a> <a href="Network-NBD-Server-Simple.html#t:HostPreference">HostPreference</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a href="/home/nicolas/Projects/ghc/share/doc/ghc/html/libraries/base-4.6.0.0/Data-Ord.html#t:Ord">Ord</a> <a href="Network-NBD-Server-Simple.html#t:HostPreference">HostPreference</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a href="/home/nicolas/Projects/ghc/share/doc/ghc/html/libraries/base-4.6.0.0/Text-Read.html#t:Read">Read</a> <a href="Network-NBD-Server-Simple.html#t:HostPreference">HostPreference</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a href="/home/nicolas/Projects/ghc/share/doc/ghc/html/libraries/base-4.6.0.0/Text-Show.html#t:Show">Show</a> <a href="Network-NBD-Server-Simple.html#t:HostPreference">HostPreference</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a href="/home/nicolas/Projects/ghc/share/doc/ghc/html/libraries/base-4.6.0.0/Data-String.html#t:IsString">IsString</a> <a href="Network-NBD-Server-Simple.html#t:HostPreference">HostPreference</a></td><td class="doc empty">&nbsp;</td></tr></table></div></div></div><div class="top"><p class="src"><a name="v:nBD_DEFAULT_PORT" class="def">nBD_DEFAULT_PORT</a> :: <a href="/home/nicolas/Projects/ghc/share/doc/ghc/html/libraries/base-4.6.0.0/Data-Int.html#t:Int">Int</a></p><div class="doc"><p>The default (IANA-assigned) port for NBD
</p></div></div><div class="top"><p class="src"><a name="v:runServer" class="def">runServer</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="Network-NBD-Server-Simple.html#t:ServerSettings">ServerSettings</a></td><td class="doc"><p>Listen address
</p></td></tr><tr><td class="src">-&gt; <a href="/home/nicolas/Projects/ghc/share/doc/ghc/html/libraries/base-4.6.0.0/Data-Maybe.html#t:Maybe">Maybe</a> [<a href="Network-NBD.html#t:ExportName">ExportName</a>]</td><td class="doc"><p>Optional list of export names to expose to the client. If <code><a href="/home/nicolas/Projects/ghc/share/doc/ghc/html/libraries/base-4.6.0.0/Data-Maybe.html#v:Nothing">Nothing</a></code>, export listing is disabled.
</p></td></tr><tr><td class="src">-&gt; <a href="Network-NBD-Server-Simple.html#t:ExportMaker">ExportMaker</a></td><td class="doc"><p>Action to retrieve an <code><a href="Network-NBD-Server-Simple.html#t:ExportHandler">ExportHandler</a></code> for a given client connection
</p></td></tr><tr><td class="src">-&gt; <a href="/home/nicolas/Projects/ghc/share/doc/ghc/html/libraries/base-4.6.0.0/System-IO.html#t:IO">IO</a> ()</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Run an NBD server
</p></div></div><h1 id="g:4">Utilities
</h1><div class="top"><p class="src"><a name="v:withBoundsCheck" class="def">withBoundsCheck</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="/home/nicolas/Projects/ghc/share/doc/ghc/html/libraries/base-4.6.0.0/Control-Monad.html#t:Monad">Monad</a> m</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">=&gt; <a href="Network-NBD-Server-Simple.html#t:ByteCount">ByteCount</a></td><td class="doc"><p>Size of the export we're dealing with
</p></td></tr><tr><td class="src">-&gt; <a href="Network-NBD-Server-Simple.html#t:FileOffset">FileOffset</a></td><td class="doc"><p>Offset of the request
</p></td></tr><tr><td class="src">-&gt; <a href="Network-NBD-Server-Simple.html#t:ByteCount">ByteCount</a></td><td class="doc"><p>Length of the request
</p></td></tr><tr><td class="src">-&gt; m (<a href="Network-NBD-Server-Simple.html#t:Response">Response</a> a)</td><td class="doc"><p>Action to execute if request is within bounds
</p></td></tr><tr><td class="src">-&gt; m (<a href="Network-NBD-Server-Simple.html#t:Response">Response</a> a)</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Utility action to validate request boundaries. This action will return
 <code><a href="/home/nicolas/Projects/ghc/share/doc/ghc/html/libraries/base-4.6.0.0/Foreign-C-Error.html#v:eINVAL">eINVAL</a></code> to the client if an out-of-bounds request was received
</p></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.12.0</p></div></body></html>